# 1. 구체적인 프롬프트 사용

- 모호한 요청은 토큰낭비의 가장 큰 원인

``` javascript
- ❌ 비효율적 (불필요한 반복 발생) "이거 좀 더 좋게 만들어줘"
- ✅ 효율적 (한 번에 해결) "src/auth.js의 가독성 개선 - 상수 분리, 에러 핸들링 추가"
  
# 관련 작업은 하나의 요청으로 묶으면 라운드트립 줄일 수 있음
"auth.js, user.js, api.js의 에러 핸들링 일괄 업데이트"
```

# 2. 파일 구조 작게 모듈화
Claude가 파일을 읽을 때 전체 파일이 컨텍스트에 올라감

```javascript
# ❌ 하나의 거대한 파일
src/utils.ts (2,000줄) → 전부 읽혀서 토큰 낭비

# ✅ 작은 단위로 분리
src/utils/validation.ts (100줄)
src/utils/formatting.ts (80줄)
src/utils/dates.ts (60줄)
→ 필요한 파일만 읽음
```

CLAUDE.md에서 읽지 말아야 할 디렉토리를 명시하면 불필요한 파일 탐색도 방지됨.



# 3. CLAUDE.md 최적화

- CLAUDE.md 파일은 매 세션마다 자동 로드되어 입력 토큰 소모
- 원칙 : 5,000 토큰 이하로 유지
- 처음 200줄에 핵심정보만 배치(토큰 62% 절감)
- 읽어야 할 파일과 금지된 디렉토리 명시



```javascript
1. 프로젝트 요약 
   -Next.js 14 + TypeScript + Prisma + postgresSQL
2. 코드 컨벤션
   - 함수명 : camelCase , 컴포넌트 : PascalCase
   - 여려 핸들링 : Result 패턴 사용    
3. 현재 진행 중
   -결제 모듈 리팩토링(payments/디렉토리)
4. 금지 영역   
  읽지 말 것 /node_modules, /dist, /.git 
- 주요 파일 src/core/*.ts - 핵심 로직
```

### 계층적 분리 전략

상세한 문서는 별도 파일로 분리하고, 필요할 때만 참조

``` javascript
CLAUDE.md           ← 핵심 컨텍스트만 (항상 로드)
docs/architecture.md  ← 필요시 참조
docs/api-spec.md      ← 필요시 참조
docs/testing-guide.md ← 필요시 참조
```



# 4. 세션 관리

- 대화가 길어지면 매 메시지마다 전체 대화 히스토리가 입력토큰으로 재전송됨
- 작업별로 새 세션 시작(이전 히스토리 불필요)
- 작업이 바뀌면 무조건 새 세션 시작해야 함. 긴 세션에서 여러 작업을 처리하면 토큰이 기하급수적으로 증가함

| 명령어             | 용도              | 언제 사용?                            |
| --------------- | --------------- | --------------------------------- |
| `/compact`      | 대화 요약 후 컨텍스트 압축 | 대화가 길어졌을 때 수시로                    |
| `/compact [지시]` | 특정 내용에 집중하여 요약  | 예: `/compact 코드 변경사항과 테스트 결과에 집중` |
| `/clear`        | 컨텍스트 완전 초기화     | 완전히 다른 작업으로 전환할 때                 |
| `/stats`        | 구독자용            | 사용패턴 확인                           |


# 5. 모델 전략적 선택
### plan모드로 비싼 재작업 예방
- **Opus**: 복잡한 설계, 아키텍처 결정용으로만
- **Sonnet**: 일반 코딩, 구현에는 Sonnet으로 충분
- 평균 40-70% 비용 절감 가능
### opusplan 전략 
- Plan Mode 에서만 Opus를 쓰고 , 실제 구현은 Soonet으로 자동 전환
- Claude가 코드베이스를 탐색하고 계획만 제안
- 사용자가 승인한 후에만 구현 시작


# 6. MCP 서버 정리
- 사용하지 않는 MCP 서버 비활성화
- 활성화된 MCP서버마다 도구 정의가 시스템 프롬프트에 추가되어 컨텍스트 소모


```javascript
/context : 현재 사용 중인 서버 확인
/mcp : 사용하지 않는 MCP서버 비활성화
@server-name disable : 불필요한 서버 끄기
```


# 7. 토큰 사용량 모니터링


```javascript
#claude-monitor 설치
npm install -g calude-monitor

#실시간 토큰 사용량 확인
claude-monitor --view session
```


# 8. 환경 변수 설정

```javascript
# 중요하지 않은 백그라운드 호출 억제 
export DISABLE_NON_ESSENTIAL_MODEL_CALLS=1
```


# 9. 실전 워크플로우 체크리스트

매 세션을 시작할 때 이 흐름을 따르면 토큰 낭비를 크게 줄일 수 있습니다.

```javascript
1. 새 작업 → 새 세션 시작 (/clear 또는 새 터미널)
2. 모델 선택 → 단순 작업이면 Sonnet, 복잡하면 Plan 모드 진입
3. 구체적으로 요청 → 파일명, 함수명, 원하는 결과를 명시
4. 방향이 틀리면 → 즉시 Escape로 중단
5. 대화가 길어지면 → /compact로 압축
6. 작업 전환 시 → /clear 또는 새 세션
7. 세션 끝 → /cost로 사용량 확인 및 회고
```

